<div class="row">
    <div class="col-xl-5 col-lg-5">
        <div class="input-group mt-3">
            <input type="text" class="form-control" placeholder="new ToDo title" #newTodo
            (keyup.enter)="addTodo(newTodo.value); newTodo.value=''">
        
            <button class="btn btn-primary" type="button"
            (click)="addTodo(newTodo.value); newTodo.value=''">Create new ToDo</button>
        </div>
    </div>
</div>

<div class="text-muted m-3" *ngIf="todos && (todos.length == 0 || todos == undefined)">
    <h4>There are no ToDo lists.</h4>
</div>

<div ngbAccordion [closeOthers]="true" class="mt-3" *ngIf="todos">
    <div ngbAccordionItem *ngFor="let todo of todos; let i=index">
        <h2 ngbAccordionHeader>
            
            <button ngbAccordionButton *ngIf="!editingTodo.editing && !editingTodo.todo">
                <button class="btn p-0 md-1 text-info" type="button" ngbTooltip="edit" (click)="$event.stopPropagation();editTodoTitle(todo)">
                    <i class="bi bi-pencil-square"></i>
                </button>
                {{ todo.title }}
            </button>

            <div class="input-group" *ngIf="editingTodo.editing && editingTodo.todo" ngClass="p-3">
                <input type="text" class="form-control text-bg-dark" placeholder="{{editingTodo.todo.title }}" #editItem value="{{editingTodo.todo.title}}"
                (keyup.enter)="finishEditItem(true, editItem.value)">

                <button class="btn btn-primary" type="button"
                (click)="finishEditItem(true, editItem.value)">Confirm</button>

                <button class="btn btn-secondary" type="button" 
                (click)="finishEditItem(false, editItem.value)">Cancel</button>
            </div>
            
        </h2>
        <div class="progress">
            <div class="progress-bar bg-success progress-bar-striped" role="progressbar" [ngStyle]="{'width': todo.complete + '%'}"></div>
        </div>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <ng-template>
                    <button class="btn btn-danger m-3" type="button" (click)="deleteTodo(todo)">Delete ToDo List</button>

                    <ul style="list-style-type: none;">
                        <li *ngFor="let item of todos[i].todoItems">
                            <div class="form-check-inline">
                                <button class="btn p-0 mb-1" type="button" (click)="deleteItem(todos[i], item)" ngbTooltip="delete">
                                    <i class="bi bi-trash text-danger"></i>
                                </button>

                                <button class="btn p-0 mb-1" type="button" (click)="startEditItem(item)" ngbTooltip="edit">
                                        <i class="bi bi-pencil-square text-info"></i>
                                </button>

                                <input class="form-check-input mx-1" type="checkbox" [checked]="item.completed" (click)="updateCheck(item)">

                                <label class="form-check-label" [ngClass]="item.completed ? 'text-muted' : ''"> {{ item.text }} </label>
                            </div>
                        </li>
                    </ul>
                    
                    <div class="input-group" *ngIf="!editingItem.editing">
                        <input type="text" class="form-control" placeholder="enter new item" #newItem
                        (keyup.enter)="addNewItem(todo, newItem.value); newItem.value=''">

                        <button class="btn btn-primary" type="button" 
                        (click)="addNewItem(todo, newItem.value); newItem.value=''">Add item</button>
                    </div>

                    <div class="input-group" *ngIf="editingItem.editing && editingItem.item">
                        <input type="text" class="form-control" placeholder="{{editingItem.item.text}}" #editItem value="{{editingItem.item.text}}"
                        (keyup.enter)="finishEditItem(true, editItem.value)">

                        <button class="btn btn-primary" type="button"
                        (click)="finishEditItem(true, editItem.value)">Confirm</button>

                        <button class="btn btn-secondary" type="button" 
                        (click)="finishEditItem(false, editItem.value)">Cancel</button>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>


